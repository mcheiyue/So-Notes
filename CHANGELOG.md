# 更新日志 (Changelog)

本项目的所有重要变更都将记录在此文件中。

## [v1.1.7] - 2026-02-10

### 🚀 优化 (Optimizations)
*   **MiniMap 深度重构 (Performance)**
    > 彻底重写了 MiniMap 的渲染逻辑。通过引入原子化组件 (`MiniMapNoteItem`) 和 `React.memo` 防线，成功解决了拖拽笔记时导致的 O(N) 全量重绘问题。现在即使有上千个笔记，拖拽也丝般顺滑。
*   **视口拖拽零延迟 (Zero-Latency Drag)**
    > 针对 MiniMap 的视口红框实现了“直接 DOM 操作 + RAF 节流”的双轨更新机制。消除了因 React 渲染循环导致的“不跟手”和滞后感。
*   **Canvas 平移节流**
    > 将画布的视口平移逻辑从高频 React 更新中解耦，改用 `requestAnimationFrame` 循环驱动，显著降低了主线程负载。

### ✨ 新特性 (Features)
*   **快捷键系统 (Shortcuts)**
    > 引入了全新的快捷键管理器，支持以下高频操作：
    > *   `Delete` / `Backspace`: 删除选中笔记
    > *   `Ctrl + A` (Mac: Cmd + A): 全选当前看板笔记
    > *   `Ctrl + D` (Mac: Cmd + D): 创建选中笔记的副本
    > *   `Ctrl + 0` (Mac: Cmd + 0): 重置视口位置

### 🧹 清理 (Cleanup)
*   **Store 订阅优化**: 全面应用 `useShallow` 进行细粒度状态订阅，消除了父组件因无关状态变化产生的无效重绘。

## [v1.1.6] - 2026-02-10

### ✨ 新特性 (Features)
- **交互式小地图 (Interactive MiniMap)**:
  - **点击跳转**: 点击小地图任意位置，画布立即平滑跳转至该坐标。
  - **视口拖拽**: 支持在小地图上直接拖拽视口框，像专业设计软件一样快速漫游全局。
  - **常驻显示**: 优化了显示逻辑，小地图现已支持常驻（闲置半透明），方便随时定位。
- **无限画布体验优化**:
  - **全域漫游**: 修复了负坐标区域无法导航的问题，现在您可以自由探索画布的每一个角落。

### ⚡ 性能优化 (Performance)
- **极致流畅**: 重构了 `MiniMap` 的渲染逻辑，移除冗余计算，彻底解决了拖拽便签时的卡顿问题。
- **资源占用**: 优化了长列表渲染，大幅降低内存占用。

### 🐛 问题修复 (Bug Fixes)
- **布局回归**: 修复了折叠模式下便签宽度过窄导致标题截断的问题，恢复了经典的舒适阅读体验 (300px)。
- **显示修复**: 修复了小地图在特定情况下尺寸计算错误导致不可见的问题。

### 🧹 重构 (Refactor)
- **代码整洁**: 提取 `src/constants/layout.ts` 统一管理布局常量，代码结构更清晰。

## [v1.1.5] - 2026-02-09

### ✨ 新特性 (Features)
- **无限画布 (Infinite Canvas)**: 突破屏幕限制，支持拖拽便签扩展画布。
- **三轨交互模式**: 安全模式(Safe Mode)、推墙扩展(Push-to-Expand)、摄像机模式(Camera Mode)。
- **全局导航小地图 (Mini-Map)**: 推墙或平移时自动浮现，支持快速跳转。
- **视口记忆**: 切换看板时自动保存视口位置。
- **快速归位**: 双击 Space 或托盘菜单重置视口。

### 🚀 优化 (Optimizations)
- 统一拖拽边界逻辑，修复窗口拉伸适配问题。
- 优化拖拽渲染性能，消除推墙抖动。

## [v1.1.4] - 2026-02-07

### ✨ 新特性 (Features)
*   **看板数据导入导出 (Import/Export)**
    > 数据主权回归！现在您可以自由导出看板数据进行备份或迁移。
    *   **全量备份**: 一键导出所有看板、便签及设置数据为 `.json` 文件。
    *   **单板导出**: 支持仅导出当前看板（在看板视图下可用）。
    *   **智能导入**: 导入的数据会自动重生成 ID，避免覆盖现有内容，并标记为 `(Imported)`。
*   **交互优化 (UI Improvements)**
    *   **Dock 栏升级**: 新增设置菜单（⚙️），整合了导入导出功能。
    *   **上下文菜单瘦身**: 画布右键菜单精简为“显示菜单”、“新建便签”等核心操作，移除冗余项。

### 🐛 问题修复 (Bug Fixes)
*   **权限修复**: 修复了导出文件时因权限不足导致的 `fs.write_text_file` 错误。
*   **类型安全**: 修复了 Store 类型定义中 Action 与 Data 混淆的问题，增强代码健壮性。

## [v1.1.3] - 2026-02-07

### ✨ 新特性 (Features)
*   **废纸篓 (Trash Bin)**
    > 再也不用担心误删笔记了！全新的废纸篓功能为您提供了一颗后悔药。
    > *   **网格视图**：已删除的笔记会整齐地排列在专属的废纸篓视图中，方便查找。
    > *   **软删除**：删除操作不再立即销毁数据，而是将其移入废纸篓。
    > *   **一键还原**：支持将误删的笔记还原到其原本所在的看板（如果看板已删除，则还原到当前看板）。
    > *   **永久删除**：当然，您也可以在废纸篓中彻底粉碎它们。

*   **废纸篓入口**
    > 在看板栏 (Dock) 底部新增了专门的垃圾桶图标，点击即可快速切换到废纸篓视图。

### 🚀 优化 (Optimizations)
*   **交互安全 (Interaction Safety)**
    > 当您在看板视图和废纸篓视图之间切换时，系统会自动清除当前的选中状态。这防止了在不同视图下因为选中状态残留而导致的误操作（例如“幽灵删除”）。

*   **视觉与本地化 (UI & Localization)**
    > *   废纸篓视图已完全适配中文界面。
    > *   优化了 BoardDock 的遮罩逻辑：现在在废纸篓模式下，Dock 不再被全屏透明遮罩阻挡，按钮点击更加灵敏准确。
    > *   废纸篓中的卡片现在会显示为半透明灰色，且禁用了拖拽，从视觉上明确其“不可用”状态。

## [v1.1.2] - 2026-02-06

### ✨ 新特性 (Features)
*   **批量管理增强 (Batch Operations)**
    > 右键菜单现在支持对选中的多个便签进行 **批量移动** 和 **批量复制**。操作时会自动对目标位置进行智能避让，防止堆叠。
*   **看板排序 (Board Reorder)**
    > 在看板栏图标上 **右键 -> 调整顺序**，即可使用键盘 `←` / `→` 快速调整看板位置。

### 🐛 问题修复 (Bug Fixes)
*   **性能优化 (Performance)**: 重构了便签组件 (`NoteCard`) 的渲染逻辑，将状态订阅改为原子化，彻底解决了拖拽时的卡顿与掉帧问题。
*   **交互修复**: 修复了拖拽便签时 Tooltip 提示框残留不消失的问题。
*   **UI 回归**: 修复了左上角看板指示器 (Badge) 消失或无法实时刷新名称的问题。
*   **安全删除**: 现在删除包含多个便签的群组时，会要求二次确认，防止误操作。

## [v1.1.1] - 2026-02-06

### ✨ 新特性 (Features)
*   **右键管理升级 (Advanced Context Menu)**
    > 右键菜单新增了强大的便签管理能力，无需复杂的快捷键。
    > *   **📄 创建副本**: 一键在当前位置生成便签副本。
    > *   **➡️ 移动到看板**: 将便签快速转移到其他看板，支持智能避让，防止位置重叠。
    > *   **⤴️ 复制到看板**: 跨看板克隆便签。
    > *   **交互优化**: 二级菜单采用 300ms 延迟关闭机制，操作更加从容丝滑。
*   **看板原地重命名 (In-place Rename)**
    > 双击底部 Dock 栏图标，或使用右键菜单，即可原地修改看板名称。无需跳转，所见即所得。

### 🚀 优化 (Optimizations)
*   **安全删除机制 (Safe Delete)**
    > 删除了“移动到默认看板”的隐晦逻辑，改为**彻底删除**看板及其下属便签。
    > *   **智能防误删**: 删除前会自动检测看板内是否有便签。若有，按钮变红并显示“确认删除 N 条便签？”，二次点击方可执行。
*   **一键归拢修正 (Smart Arrange Fix)**
    > 修复了“一键归拢”会错误地将其他看板的便签也吸附过来的 Bug。现在它只整理当前视野内的便签。

## [v1.1.0] - 2026-02-05

### ✨ 新特性 (Features)
*   **多看板系统 (Multi-Board System)**
    > SoNotes 不再局限于一张桌布。现在您可以创建多个独立的“看板”（如工作、生活、灵感），通过右键菜单或底部 Dock 快速切换，让不同领域的便签井井有条。
    *   **极简切换**: 右键点击“切换看板”即可呼出底部 Dock。
    *   **Mac 风格 Dock**: 悬浮药丸设计，带丝滑进场动画与智能缩放，点击空白自动消失。
    *   **无限扩展**: 支持创建无限个看板，内置防误删保护（右键删除）。
*   **可视化钉住状态 (Visual Pin State)**
    > 告别隐式状态。现在当您将窗口“钉住”时，右上角会出现一个精致的悬浮按钮。点击它即可一键取消钉住，恢复“失焦隐藏”模式。

### 🐛 问题修复 (Bug Fixes)
*   **视口偏移 (Viewport Shift)**: 彻底移除了 `100vw` 布局，根除了 Windows 下因滚动条计算导致的界面 15px 偏移问题。
*   **Dock 布局 (Layout)**: 修复了 Dock 在窗口拉伸时的左偏问题，采用更稳健的 Flex 隔离布局策略。
*   **拖拽遮挡 (Z-Index)**: 提升了顶部拖拽区域的层级 (`z-100000`)，确保即使便签置顶也不会阻碍窗口移动。
*   **智能聚焦 (Smart Focus)**: 优化了输入框聚焦逻辑，现在只有刚刚创建的便签会自动激活输入，切换看板时不再会被旧便签抢夺焦点。

### 🧹 清理 (Cleanup)
*   **架构重构**: 将 `BoardDock`, `PinFab`, `ContextMenu` 移至 App 层级，解决了 CSS Filter 导致的层叠上下文 (Stacking Context) 问题。
*   **代码整洁**: 移除了所有开发调试日志 (Console Logs) 并提取了图标常量。

## [v1.0.9] - 2026-02-04

### 🚀 优化 (Optimizations)
*   **UI 精致化 (Visual Polish)**
    > 重写了应用内滚动条样式。移除了突兀的原生白色滚动条，取而代之的是极细（6px）、圆角、半透明的现代样式，且完美贴合便签边缘，大幅提升了视觉沉浸感。
*   **智能折叠 (Smart Compact Mode)**
    > 未选中的便签现在会自动收起高度（至 200px），并应用底部渐隐遮罩，优雅地提示“更多内容”。选中后瞬间展开，既保证了桌面整洁，又方便随时查阅。

### 🐛 问题修复 (Bug Fixes)
*   **视窗偏移 (Layout Shift)**: 修复了长文本便签会导致整个应用视窗坐标系下移，从而将其他便签“顶”出屏幕外的严重布局问题。
*   **托盘位置 (Tray Positioning)**: 修复了程序启动后直接点击“钉住窗口”时，窗口可能出现在屏幕左侧默认位置而非右下角的问题。
*   **新建聚焦 (Focus Logic)**: 修复了使用“粘贴并新建”功能时，标题输入框未自动获得焦点的问题。

## [v1.0.8] - 2026-02-04

### ✨ 新特性 (Features)
*   **智能右键菜单 (Smart Context Menu)**
    > 右键菜单逻辑全新重构。现在它能智能识别“画布模式”与“群组模式”：
    > *   **画布模式 (Global Mode)**: 当无选中或仅选中单个便签时，提供新建、粘贴等全局操作。
    > *   **群组模式 (Group Mode)**: 当选中多个便签时，自动切换为群组操作菜单，支持批量整理、删除。
*   **粘贴并新建 (Paste to Create)**
    > 右键点击画布空白处，选择“粘贴并新建”即可直接将剪贴板文本转换为新便签。
    > *   **自动聚焦**: 新建后光标自动聚焦于标题输入框，方便快速命名。
*   **一键归拢 (Smart Arrange)**
    > 无论便签多么散乱，只需一键即可恢复整洁。
    > *   **智能排序**: 基于空间位置（从左到右、从上到下）重新排列，保留您的视觉记忆。
    > *   **行高自适应**: 采用紧凑的行布局，自动换行并适配卡片高度。
    > *   **防误触**: 全局归拢操作增加了二次确认机制（Click-to-Confirm）。

### 🚀 优化 (Optimizations)
*   **UI 净化**: 移除了右下角冗余的新建按钮 (FAB)，界面更加纯净。
*   **交互一致性**: 修复了删除便签后可能导致右键菜单误判选中态的“幽灵选中”问题。
*   **单选逻辑**: 单个便签不再触发“整理选中”选项，逻辑更清晰。

### 🔧 依赖更新 (Dependencies)
*   引入 `@tauri-apps/plugin-clipboard-manager` 以支持剪贴板操作。

## [v1.0.7] - 2026-02-03

### ✨ 新特性 (Features)
*   **交互全面升级 (Interaction Overhaul)**
    > 让桌面便签拥有媲美专业软件的操作体验。
    *   **框选系统 (Marquee Selection)**: 在画布空白处拖动，即可批量选中便签。
    *   **右键菜单 (Context Menu)**: 
        *   **画布**: 支持直接新建便签、一键整理。
        *   **便签**: 支持更改颜色、置顶、删除，以及全新的吸附移动入口。
    *   **群组交互 (Group Interaction)**: 
        *   选中多个便签后，拖动其中任意一个，整个组将保持队形一起移动。
        *   支持 Ctrl/Shift 点击加选。
*   **整理便签 (Snap to Grid)**
    *   右键菜单新增“整理便签”，一键将凌乱的便签对齐到网格，强迫症福音。

### 🐞 修复与优化 (Fixes & Improvements)
*   **边界保护 (Boundary Guard)**
    *   **单体**: 拖拽便签到屏幕边缘时，会被强制阻挡在屏幕内（保留 100px 可见区域）。
    *   **群组**: 智能的分布式边界检查，群组中任何便签触碰边界都会被自动“收拢”进屏幕，确保不会有便签遗失在屏幕外。
*   **视觉优化**
    *   全新的选中样式：单选为素雅白框，多选为醒目蓝框。
    *   优化了吸附移动 (Sticky Drag) 的视觉反馈。

## [v1.0.6] - 2026-02-03

### ✨ 新特性 (Features)
*   **托盘钉住 (Pin Mode)**
    > 需要便签一直显示以便参考？托盘右键菜单新增 **"钉住窗口"** 开关。
    *   开启后，窗口将置顶常驻，不再自动隐藏。
    *   菜单文案会动态变为“取消钉住”，状态一目了然。

### 🐞 修复与优化 (Fixes & Improvements)
*   **智能自动隐藏 (Smart Auto-Hide)**
    > 彻底重构了窗口隐藏逻辑，解决了一系列痛点：
    *   **Alt+Tab 修复**: 修复了切换应用时，若鼠标还在窗口内导致窗口无法关闭（死锁）的问题。
    *   **拖动保护**: 修复了拖动窗口标题栏时，因 Windows 系统机制导致窗口误判失焦而消失的问题。
    *   **即用即走**: 现在无论是点击外部、切换应用还是移出鼠标，窗口都能精准响应，从不“粘人”，也从不“误触”。

## [v1.0.5] - 2026-02-02

### ✨ 新特性 (Features)
*   **托盘增强 (Tray)**
    > 窗口“迷路”了？托盘右键菜单新增 **"重置窗口"** 按钮。点击即可一键将窗口大小重置为 400x600，并自动归位至屏幕右下角。

### 🐛 问题修复 (Bug Fixes)
*   **数据同步 (Sync)**: 引入了**时间戳仲裁机制**。启动时自动对比磁盘文件与缓存数据的更新时间，强制使用最新版本。这彻底解决了在开发版与发布版交替使用（或多设备同步）时，新数据被旧缓存覆盖的严重问题。
*   **数据格式 (Format)**: `data.json` 保存时启用 2 空格缩进，现在您可以直接用文本编辑器轻松阅读和修改数据文件。

## [v1.0.4] - 2026-02-02

### ✨ 新特性 (Features)
*   **交互式待办 (Interactive Todo)**
    > 不再是静态文本。现在您可以直接点击 Markdown 列表中的 `[ ]` 方框来勾选任务，无需进入编辑模式，体验如同原生 Todo 应用般丝滑。
*   **折叠模式 (Roll-up Mode)**
    > 专注工作，拒绝干扰。**双击便签顶部拖拽栏**，便签将瞬间收起，仅保留 36px 高的标题栏，极大释放桌面空间。再次双击即可展开。
*   **智能标题 (Smart Title)**
    *   **极简设计**: 标题输入框仅在鼠标悬停或已有内容时显示，平时自动隐藏，保持界面纯净。
    *   **状态提示**: 当便签折叠且无标题时，会自动显示“未命名便签”占位符，防止内容迷失。

### 🐛 问题修复 (Bug Fixes)
*   **界面裁剪 (UI Clipping)**: 彻底重构了 Tooltip 组件（采用 React Portal 渲染），解决了在折叠模式或窗口边缘时，悬浮提示被父容器裁剪遮挡的视觉缺陷。

## [v1.0.3] - 2026-02-02

### ⚠️ 重大变更 (Breaking Changes)
*   **品牌重塑 (Rebranding)**
    > 项目名称由 "TrayNotes" 正式更名为 "**SoNotes**" (随心记)。
*   **数据迁移 (Migration)**
    *   数据存储路径由 `Documents/TrayNotes` 变更为 `Documents/SoNotes`。
    *   **迁移指南**: 旧版本用户需手动将原文件夹内的 `data.json` 和 `assets` 目录移动到新位置以保留数据。

### 🐛 核心修复 (Critical Fixes)
*   **数据持久化 (Persistence)**: 实现了原子写入+回退机制。当遇到文件锁定（如杀毒软件扫描）时，会自动降级处理，确保数据绝对安全，不再丢失。
*   **启动恢复 (Recovery)**: 修复了应用启动时偶发的空白问题。现在会优先检查 IndexedDB，若为空则自动从磁盘读取备份。

### ✨ 新特性 (Features)
*   **边界卫士 (Boundary Guard)**: 当便签被意外拖拽出屏幕（坐标 < 0）时，会自动吸附回 `(0, 0)`，防止便签“离家出走”。

## [v1.0.2] - 2026-02-01

### ✨ 新特性 (Features)
*   **右键吸附 (Sticky Drag)**
    > 专为触控板用户优化。无需一直按住鼠标，在拖动栏**点击右键**即可进入“跟随模式”，便签会粘在鼠标上，再次点击即可放置。
*   **操作提示 (Tooltip)**: 拖动栏增加延迟 1秒的悬浮提示，帮助新用户发现隐藏功能。

### 🐛 问题修复 (Bug Fixes)
*   **界面高度 (Height)**: 修复便签启动时高度被压缩的问题，现自动根据内容展开。
*   **层级修复 (Z-Index)**: 点击文字区域现在能正确将当前便签置顶。
*   **交互修复 (Interaction)**: 恢复了双击背景空白处新建便签的功能。

### 🚀 优化 (Optimizations)
*   **体积优化 (Size)**: 开启 LTO 和符号表剔除，安装包体积减少约 30%。

## [v1.0.1] - 2026-02-01

### ✨ 视觉升级 (Visual Upgrades)
*   **云母效果 (Mica)**: 启用 Windows 11 原生磨砂玻璃背景，让应用与系统完美融合。
*   **智能柔光 (Dimming)**: 深色模式下自动调整不透明度和滤镜，夜间使用更加护眼。
*   **多彩配色 (Themes)**: 新增 6 种莫兰迪色系，共 13 种颜色可选，满足您的个性化需求。

### 💄 界面优化 (UI/UX)
*   **无边框设计 (Borderless)**: 移除原生阴影，改用 1px 精致内描边，消除黑角伪影，质感倍增。
*   **全面汉化 (i18n)**: 界面与托盘菜单完全中文化，更加亲切。

## [v1.0.0] - 2026-02-01

### 🎉 首次发布 (Initial Release)
*   **SoNotes (随心记)** 首个版本发布。
*   **核心功能 (Core)**:
    *   🖼️ **原生体验**: Windows 11 风格 (Mica + Fluent Design)。
    *   ⚡ **极速交互**: 极简托盘，双击新建，自动保存。
    *   🔒 **隐私安全**: 数据完全本地存储，无云端上传风险。
