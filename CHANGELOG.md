# 更新日志 (Changelog)

本项目的所有重要变更都将记录在此文件中。

## [v1.0.8] - 2026-02-04

### ✨ 新特性 (Features)
*   **智能右键菜单 (Smart Context Menu)**
    > 右键菜单逻辑全新重构。现在它能智能识别“画布模式”与“群组模式”：
    > *   **画布模式 (Global Mode)**: 当无选中或仅选中单个便签时，提供新建、粘贴等全局操作。
    > *   **群组模式 (Group Mode)**: 当选中多个便签时，自动切换为群组操作菜单，支持批量整理、删除。
*   **粘贴并新建 (Paste to Create)**
    > 右键点击画布空白处，选择“粘贴并新建”即可直接将剪贴板文本转换为新便签。
    > *   **自动聚焦**: 新建后光标自动聚焦于标题输入框，方便快速命名。
*   **一键归拢 (Smart Arrange)**
    > 无论便签多么散乱，只需一键即可恢复整洁。
    > *   **智能排序**: 基于空间位置（从左到右、从上到下）重新排列，保留您的视觉记忆。
    > *   **行高自适应**: 采用紧凑的行布局，自动换行并适配卡片高度。
    > *   **防误触**: 全局归拢操作增加了二次确认机制（Click-to-Confirm）。

### 🚀 优化 (Optimizations)
*   **UI 净化**: 移除了右下角冗余的新建按钮 (FAB)，界面更加纯净。
*   **交互一致性**: 修复了删除便签后可能导致右键菜单误判选中态的“幽灵选中”问题。
*   **单选逻辑**: 单个便签不再触发“整理选中”选项，逻辑更清晰。

### 🔧 依赖更新 (Dependencies)
*   引入 `@tauri-apps/plugin-clipboard-manager` 以支持剪贴板操作。

## [v1.0.7] - 2026-02-03

### ✨ 新特性 (Features)
*   **交互全面升级 (Interaction Overhaul)**
    > 让桌面便签拥有媲美专业软件的操作体验。
    *   **框选系统 (Marquee Selection)**: 在画布空白处拖动，即可批量选中便签。
    *   **右键菜单 (Context Menu)**: 
        *   **画布**: 支持直接新建便签、一键整理。
        *   **便签**: 支持更改颜色、置顶、删除，以及全新的吸附移动入口。
    *   **群组交互 (Group Interaction)**: 
        *   选中多个便签后，拖动其中任意一个，整个组将保持队形一起移动。
        *   支持 Ctrl/Shift 点击加选。
*   **整理便签 (Snap to Grid)**
    *   右键菜单新增“整理便签”，一键将凌乱的便签对齐到网格，强迫症福音。

### 🐞 修复与优化 (Fixes & Improvements)
*   **边界保护 (Boundary Guard)**
    *   **单体**: 拖拽便签到屏幕边缘时，会被强制阻挡在屏幕内（保留 100px 可见区域）。
    *   **群组**: 智能的分布式边界检查，群组中任何便签触碰边界都会被自动“收拢”进屏幕，确保不会有便签遗失在屏幕外。
*   **视觉优化**
    *   全新的选中样式：单选为素雅白框，多选为醒目蓝框。
    *   优化了吸附移动 (Sticky Drag) 的视觉反馈。

## [v1.0.6] - 2026-02-03

### ✨ 新特性 (Features)
*   **托盘钉住 (Pin Mode)**
    > 需要便签一直显示以便参考？托盘右键菜单新增 **"钉住窗口"** 开关。
    *   开启后，窗口将置顶常驻，不再自动隐藏。
    *   菜单文案会动态变为“取消钉住”，状态一目了然。

### 🐞 修复与优化 (Fixes & Improvements)
*   **智能自动隐藏 (Smart Auto-Hide)**
    > 彻底重构了窗口隐藏逻辑，解决了一系列痛点：
    *   **Alt+Tab 修复**: 修复了切换应用时，若鼠标还在窗口内导致窗口无法关闭（死锁）的问题。
    *   **拖动保护**: 修复了拖动窗口标题栏时，因 Windows 系统机制导致窗口误判失焦而消失的问题。
    *   **即用即走**: 现在无论是点击外部、切换应用还是移出鼠标，窗口都能精准响应，从不“粘人”，也从不“误触”。

## [v1.0.5] - 2026-02-02

### ✨ 新特性 (Features)
*   **托盘增强 (Tray)**
    > 窗口“迷路”了？托盘右键菜单新增 **"重置窗口"** 按钮。点击即可一键将窗口大小重置为 400x600，并自动归位至屏幕右下角。

### 🐛 问题修复 (Bug Fixes)
*   **数据同步 (Sync)**: 引入了**时间戳仲裁机制**。启动时自动对比磁盘文件与缓存数据的更新时间，强制使用最新版本。这彻底解决了在开发版与发布版交替使用（或多设备同步）时，新数据被旧缓存覆盖的严重问题。
*   **数据格式 (Format)**: `data.json` 保存时启用 2 空格缩进，现在您可以直接用文本编辑器轻松阅读和修改数据文件。

## [v1.0.4] - 2026-02-02

### ✨ 新特性 (Features)
*   **交互式待办 (Interactive Todo)**
    > 不再是静态文本。现在您可以直接点击 Markdown 列表中的 `[ ]` 方框来勾选任务，无需进入编辑模式，体验如同原生 Todo 应用般丝滑。
*   **折叠模式 (Roll-up Mode)**
    > 专注工作，拒绝干扰。**双击便签顶部拖拽栏**，便签将瞬间收起，仅保留 36px 高的标题栏，极大释放桌面空间。再次双击即可展开。
*   **智能标题 (Smart Title)**
    *   **极简设计**: 标题输入框仅在鼠标悬停或已有内容时显示，平时自动隐藏，保持界面纯净。
    *   **状态提示**: 当便签折叠且无标题时，会自动显示“未命名便签”占位符，防止内容迷失。

### 🐛 问题修复 (Bug Fixes)
*   **界面裁剪 (UI Clipping)**: 彻底重构了 Tooltip 组件（采用 React Portal 渲染），解决了在折叠模式或窗口边缘时，悬浮提示被父容器裁剪遮挡的视觉缺陷。

## [v1.0.3] - 2026-02-02

### ⚠️ 重大变更 (Breaking Changes)
*   **品牌重塑 (Rebranding)**
    > 项目名称由 "TrayNotes" 正式更名为 "**SoNotes**" (随心记)。
*   **数据迁移 (Migration)**
    *   数据存储路径由 `Documents/TrayNotes` 变更为 `Documents/SoNotes`。
    *   **迁移指南**: 旧版本用户需手动将原文件夹内的 `data.json` 和 `assets` 目录移动到新位置以保留数据。

### 🐛 核心修复 (Critical Fixes)
*   **数据持久化 (Persistence)**: 实现了原子写入+回退机制。当遇到文件锁定（如杀毒软件扫描）时，会自动降级处理，确保数据绝对安全，不再丢失。
*   **启动恢复 (Recovery)**: 修复了应用启动时偶发的空白问题。现在会优先检查 IndexedDB，若为空则自动从磁盘读取备份。

### ✨ 新特性 (Features)
*   **边界卫士 (Boundary Guard)**: 当便签被意外拖拽出屏幕（坐标 < 0）时，会自动吸附回 `(0, 0)`，防止便签“离家出走”。

## [v1.0.2] - 2026-02-01

### ✨ 新特性 (Features)
*   **右键吸附 (Sticky Drag)**
    > 专为触控板用户优化。无需一直按住鼠标，在拖动栏**点击右键**即可进入“跟随模式”，便签会粘在鼠标上，再次点击即可放置。
*   **操作提示 (Tooltip)**: 拖动栏增加延迟 1秒的悬浮提示，帮助新用户发现隐藏功能。

### 🐛 问题修复 (Bug Fixes)
*   **界面高度 (Height)**: 修复便签启动时高度被压缩的问题，现自动根据内容展开。
*   **层级修复 (Z-Index)**: 点击文字区域现在能正确将当前便签置顶。
*   **交互修复 (Interaction)**: 恢复了双击背景空白处新建便签的功能。

### 🚀 优化 (Optimizations)
*   **体积优化 (Size)**: 开启 LTO 和符号表剔除，安装包体积减少约 30%。

## [v1.0.1] - 2026-02-01

### ✨ 视觉升级 (Visual Upgrades)
*   **云母效果 (Mica)**: 启用 Windows 11 原生磨砂玻璃背景，让应用与系统完美融合。
*   **智能柔光 (Dimming)**: 深色模式下自动调整不透明度和滤镜，夜间使用更加护眼。
*   **多彩配色 (Themes)**: 新增 6 种莫兰迪色系，共 13 种颜色可选，满足您的个性化需求。

### 💄 界面优化 (UI/UX)
*   **无边框设计 (Borderless)**: 移除原生阴影，改用 1px 精致内描边，消除黑角伪影，质感倍增。
*   **全面汉化 (i18n)**: 界面与托盘菜单完全中文化，更加亲切。

## [v1.0.0] - 2026-02-01

### 🎉 首次发布 (Initial Release)
*   **SoNotes (随心记)** 首个版本发布。
*   **核心功能 (Core)**:
    *   🖼️ **原生体验**: Windows 11 风格 (Mica + Fluent Design)。
    *   ⚡ **极速交互**: 极简托盘，双击新建，自动保存。
    *   🔒 **隐私安全**: 数据完全本地存储，无云端上传风险。
